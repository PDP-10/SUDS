SUBTTL	DEC ROUTER SUBRS
;ROUTER		PINSIN
;PINSIN - PINS READ IN
;READS IN THE PINS FOR ONE RUN AND COMPUTES THE DISTANCES
;BETWEEN EACH PAIR OF PINS.

ROUTE,<
PINSIN:	SETZM SCTR		;SET TO LOOK FOR SOURCE AND CABLE PINS
	SETZM HNDOSW		;CLEAR THE HAND ORDERING SWITCH
	SKIPLE	ORDFLG		;HAND ORDERING BY NUMBER?
	SETOM	HNDOSW		;YES, FLAG IT

PINSI2:	MOVEI B,1		;INDEX FOR MAKING DISTANCE TABLE
PINSI3:	SETZ C,			;COMPUTE DISTANCES TO PIN C(B)
				;FOR PINS 0 .LE. N .LE. C(B)-1
PINSI4:	MOVE A,B
	PUSH P,B
	PUSH P,C
	MOVSI T,RERPIN		;CHECK FOR PIN IN ERROR
	TDNN T,PNTBL(B)
	TDNE T,PNTBL(C)
	JRST PINSIL
	MOVE D,PNTBL2(C)
	MOVE C,PNTBL1(C)
	MOVE A,PNTBL1(B)
	MOVE B,PNTBL2(B)
	PUSHJ P,DSTCLC		;CALCULATE DISTANCE (IN WW FILE)
PINSIM:	POP P,C
	POP P,B
	PUSHJ P,MAKDST
	CAILE B,1(C)		;DONE THIS ROW?
	AOJA C,PINSI4		;NO, GET NEXT DISTANCE
	MOVE C,NUMPIN
	CAILE C,(B)		;DONE THIS TABLE?
	AOJA B,PINSI3		;NO, MAKE NEXT ROW LONGER
	POPJ P,

MAKDST:	MOVE E,C		;GET S/C COLUMNS FOR BOTH PINS
	LDB TTTT,ORDPTR		;SAVE THE ORDER CODE
	LDB TTT,SCPTR
	MOVE E,B
	LDB D,ORDPTR		;GET THE ORDER CODE FOR THE OTHER PIN
	SUB TTTT,D		;AND SAVE THE DIFFERENCE
	LDB D,SCPTR
	CAMN D,TTT		;LETTERS THE SAME?
	JRST SCHECK		;YES, CHECK IF LEGAL
	ADD D,TTT		;NO, ADD IN FUDGE FACTOR
	ADD G,FUDGE(D)
PINSI5:	MOVMS TTTT		;GET MAGNITUDE OF ORDER CODE DELTA
	SKIPE	NOHND
	JRST	PINSIG
	SKIPE HNDOSW		;HAND ORDERING?
	HRL G,TTTT		;YES, USE HAND ORDER DELTA
PINSIG:	MOVEM G,@PTRTBL-1(B)	;DEPOSIT IN TRIANGULAR TABLE
	POPJ	P,		;VIA PHANTOM DOUBLE INDEX

SCHECK:	CAIN D,4		;CHECK FOR MULTIPLE S'S
	SETOM SCTR		;SET ERROR FLAG
	CAIN D,1		;CHECK FOR MULTIPLE C'S
	ADD	G,[XWD 700,0]	;YES, ADD IN T-TO-T FUDGE FACTOR
	JRST PINSI5		;SAVE DISTANCE

FUDGE_.-1			;TABLE OF DISTANCE FUDGE FACTORS
				;SO THAT SELECTED PINS GO TO THE ENDS
	XWD 400,0		;T TO ORDINARY
	XWD 100,0		;C TO ORDINARY
	XWD 400,0		;C TO T
	XWD 100,0		;S TO ORDINARY
	XWD 400,0		;S TO T
	XWD 300,0		;S TO C

PINSIL:	MOVSI G,10000		;KLUDGE A LARGE DISTANCE ON ERROR
	JRST PINSIM
;		TOP LEVEL
;ENTER WITH POINTER TO FIRST PIN IN H
ROUTER:	PUSHJ	P,PINSIN	;MAKE DISTANCE TABLE
IFN 0,<	MOVE	A,BAYNUM
	SKIPG	B,IBWLNK(A)	;CHECK FOR ANOTHER BAY TO BE ROUTED
	JRST	ROUTR1		;NONE, GO ROUTE THIS ONE
	PUSH	P,SCTR		;SAVE FLAGS
	PUSH	P,NUMPIN
	PUSH	P,BAYNUM
	PUSHJ	P,LINKER	;INITIALIZE THE OTHER BAY
	PUSHJ	P,PINSIN
	POP	P,BAYNUM
	POP	P,A		;MERGE THE 2 PIN COUNTS
	POP	P,B		;MERGE THE 2 SCTR FLAGS
	IORM	B,SCTR
	JUMPL	A,ROUTR1	;CHECK FOR FIRST BAY EMPTY
	SETCMM	A
	ADDM	A,RUNPTR	;RESTORE ORIGINAL RUN POINTER
	MOVNS	A
	ADDM	A,NUMPIN
	CAMLE	A,NUMPIN	;CHECK FOR SECOND BAY EMPTY
	JRST	ROUTR1
	MOVE	B,CBDELT	;ADJUST BOUNDRIES OF SECOND BAY
	ASH	B,-11
	ADDM	B,BNDRY1
	ADDM	B,BNDRY3
	ADD	A,RUNPTR	;COMPUTE CROSS-BAY DISTANCES
	MOVE	B,A

ROUTR2:	MOVE	C,RUNPTR
	HLRZ	T,PNTBL(B)	;GET COORD OF PIN IN SECOND BAY
	ADD	T,CBDELT	;ADJUST RELATIVE TO THE FIRST BAY

ROUTR3:	HLRZ	TT,PNTBL(C)	;GET COORD OF PIN IN FIRST BAY
	PUSHJ	P,CBDST		;GET WIRING DISTANCE
	PUSHJ	P,MAKDST	;ADJUST AND SAVE
	CAILE	A,1(C)
	AOJA	C,ROUTR3
	MOVE	C,NUMPIN
	ADD	C,RUNPTR
	CAMLE	C,B
	AOJA	B,ROUTR2
>;END IFN 0
ROUTR1:	SKIPG	A,NUMPIN	;DETECT 0 AND 1 PIN RUNS
	POPJ P,	;JRST	RUNERR
	AOS (P)			;SKIP TO INDICATE WINNING RUN
	AOS	A
	SKIPL	ORDFLG		;HAND ORDERING BY ORDER PIN?
	JRST	PHS1		;NO,ENTER ROUTING ALGORITHMS.
;		BY ORDER PIN
;	THE FOLLOWING ROUTINE ORDERS THE RUN BY ORDER PIN ENTRIES.THE
;WIRING PATH IS DEFINED BY THE POINTER TABLE-RUNLST AND POINTERS
;CORRESPONDING TO THE END PINS OF THE RUN ARE SAVED IN 'ENDS',THUS
;DEFINING THE WIRE PATH IN THE SAME MANNER AS THE ROUTING ALGORITHMS.
;AFTER DEFINING THE PATH,A POPJ IS EXECUTED TO BY PASS THE REST OF THE ROUTER.
;	IF THE RUN IS NOT WELL DEFINED BY THE ORDER PINS,HAND ORDERING IS IGNORED
;AND THE RUN IS GIVEN TO THE ROUTING ALGORITHMS FOR PATH DEFINITION.

IFN 0,<
ILOOP0:	SETCM	B,NUMPIN	;INIT THE ORDER PIN ROUTING LOOPS.
	HRLZS	B		;B IS THE OUTER LOOP INDEX.
	HRR	B,RUNPTR
	MOVEM	B,INITLP	;SAVE FOR INIT OF INNER LOOPS.
	SETOM	F		;BLANK ORDER PIN FLAG.
ILOOP1:	MOVE	D,PNTBL(B)	;GET PINTBL INDEX FOR PIN I.
	MOVE	T,PINTBL(D)	;SAVE PIN NAME FOR PIN I.
	SKIPE	D,PINTB1(D)	;IS THERE AN ORDER PIN ENTRY?
	JRST	JLOOP0		;YES,MOVE ON TO THE NEXT LOOP.
	AOJG	F,PHS1		;NO,THIS CAN HAPPEN ONLY ONCE.
				;HOWEVER THERE MUST BE ONE BLANK.
	HRROS	RUNLST(B)	;1ST BLANK ORDER PIN,THIS IS AN END.
	HRLM	B,ENDS		;PLACE POINTER 'I' IN ENDS.
	JRST	KLOOP0		;BYPASS J LOOP.
JLOOP0:	MOVE	E,INITLP	;INIT LOOP TO SEARCH FOR PIN 'J',
				;A PIN NAME MATCHING THE ORDER PIN.
JLOOP1:	CAMN	E,B		;IS PIN J REALLY PIN I?
	JRST	JLOOP2		;YES,BYPASS.
	HRRZ	C,PNTBL(E)	;GET THE PIN NAME FOR J.
	CAMN	D,PINTBL(C)	;IS PIN J ORDER PIN I?
	JRST	JLOOP3		;YES,TERMINATE SEARCH.
JLOOP2:	AOBJN	E,JLOOP1	;NO,SET UP INDEX FOR NEW PIN J.
	JRST	PHS1		;NOMATCHES,IGNORE HAND ORDERING.
JLOOP3:	HRLM	E,RUNLST(B)	;SAVE J AS I'S NEIGHBOR.
	HRRM	B,RUNLST(E)	;SAVE I AS J'S NEIGHBOR.
KLOOP0:	MOVE	E,INITLP	;INIT LOOP TO SEARCH FOR ORDER PIN K.
KLOOP1:	CAMN	E,B		;IS PIN K REALLY PIN I?
	JRST	KLOOP2		;YES,BYPASS.
	HRRZ	C,PNTBL(E)	;NO,GET INDEX FOR PIN K.
	CAMN	D,PINTB1(C)	;IS ORDER PIN I ORDER PIN K?
	JRST	PHS1		;YES,DUPLICATE ORDER PINS,IGNORE HND ORDER.
	CAMN	T,PINTB1(C)	;IS PIN I THE SAME AS ORDER PIN K?
	JRST	ILOOP2		;YES,TERMINATE SEARCH.
KLOOP2:	AOBJN	E,KLOOP1	;SET INDEX FOR NEXT ORDER PIN.
	MOVE	D,RUNLST(B)	;NO MATCHES FOUND,CAN ONLY HAPPEN ONCE.
	TRNE	D,777777	;IS THIS THE FIRST TIME?
	JRST	PHS1		;NO,TERMINATE HAND ORDERING.
	HRRM	B,ENDS		;YES,THIS MUST BE AN END PIN.
	HLLOS	RUNLST(B)	;DESIGNATE AS AND END PIN.
ILOOP2:	AOBJN	B,ILOOP1	;TRY NEXT PIN AS THE I PIN.
	SKIPGE	F		;ALL DONE WITH APPARENT SUCCESS.
	JRST	PHS1		;NO END PINS?-FORGET IT!
	SETOM	HNDOSW		;RUN OK ACCEPT AS HAND ORDERED.
	POPJ	P,		;EXIT TO BYPASS ROUTING ALGORITHMS.
>;IFN 0
;		PHS1
;PHS1 - PHASE ONE OF RUN OPTIMIZING
;PUTS PIN 0 INTO THE RUN, THEN FINDS THE PIN NEAREST PIN 0 AND
;PUTS THAT INTO THE RUN. FROM THEN ON, IT KEEPS TRACK OF THE TWO
;END PINS OF THE RUN. THE PIN NEAREST EITHER OF THE TWO END PINS
;IS ALWAYS THE NEXT PIN PUT INTO THE RUN. THE PROCESS CONTINUES
;UNTIL THE RUN INCLUDES ALL THE PINS. THIS RUN FORMS THE FIRST
;APPROXIMATION FOR PHASE TWO WHICH FOLLOWS.

;THE RUN TABLE HAS ONE WORD FOR EACH PIN IN THE RUN. THE RIGHT
;AND LEFT HALVES OF THIS WORD HAS THE PIN NUMBERS OF THE TWO
;NEIGHBORING PINS. -1 MEANS THE END OF THE RUN.

PHS1:	SETZM	ENDS		;SET BOTH ENDS OF RUN TO FIRST PIN
	SETOM	RUNLST		;SET BOTH NEIGHBORS OF FIRST PIN TO ENDS
	MOVE	B,[XWD RUNLST,RUNLST+1]	;WIPE OUT THE WHOLE RUN TABLE
	BLT B,RUNLST+MAXP-1
	SETZM TOTDST		;SET CUMULATIVE DISTANCE TO 0
	SETZM LSTLNG		;CLEAR COUNT OF NO. PINS IN RUN
	SETOM PHSSW		;SET SWITCH TO EXAMINE 1 END
	MOVSI TTT,ROUMRK	;BIT FOR MARKING PINS IN THE RUN
	ORM	TTT,PNTBL	;MARK FIRST PIN

PHS10:	HRLOI T,377777	;SET MIN LENGTH TO INFINITY
	MOVEM T,LNGMIN
	HRRZ T,ENDS		;GET ONE END OF THE RUN

PHS11:	MOVEI TT,-1(A)	;INDEX THROUGH ALL PINS
PHS13:	TDNE TTT,PNTBL(TT)	;THIS PIN MARKED YET?
	JRST PHS12		;YES, SKIP TO NEXT PIN
	MOVE B,T		;GET THE TWO INDICES
	MOVE C,TT
	CAMG B,C		;SMALLER INDEX MUST BE IN C
	EXCH B,C
	MOVE B,@PTRTBL-1(B)	;GET DISTANCE BETWEEN PINS
	CAML B,LNGMIN		;IS IT SHORTER?
	JRST PHS12		;NO, TRY ELSEWHERE
	SETZM	LSTEMP		;FLAG NEW WINNER FOUND
	MOVEM B,LNGMIN		;YES, SAVE NEW RECORD
	MOVEM TT,LSTCND	;SAVE CANDIDATE FOR INCLUSION

PHS12:	SOJGE	TT,PHS13	;TRY NEXT PIN (DONE?)
	SOS B,PHSSW		;PERHAPS, CHECK SWITCH
	AOJN B,PHS14		;DONE THIS PASS?
	SETOM	LSTEMP		;NO, HALF DONE. FLAG 1ST HALF
	HLRZ T,ENDS		;GET OTHER END OF LIST
	JRST PHS11		;REPEAT

PHS14:	MOVE T,LSTCND	;GET THE WINNER
	ORM TTT,PNTBL(T)	;MARK IT
	SKIPL	LSTEMP		;WINNER CONNECTED TO RIGHT END?
	MOVSS ENDS		;NO, MAKE IT THE RIGHT END
	HRL T,ENDS		;GET OLD END
	HRRM T,ENDS		;SAVE NEW END
	PUSHJ P,CNEND		;CONNECT POINTERS TO NEIGHBORS
	MOVE B,LNGMIN		;ADD LENGTH INTO CUMULATIVE TOT
	ADDM B,TOTDST
	SETZM PHSSW		;RESET SWITCH
	AOS B,LSTLNG		;COUNT PINS IN RUN
	CAILE A,1(B)		;DONE PHASE 1?
	JRST PHS10		;NO, REPEAT AD INFINITUM
	CAIG	A,3		;FILTER OUT 2 &3 PIN RUNS.
	POPJ	P,
;		PHS2
;PHS2 - PHASE TWO
;EACH PIN, STARTING WITH PIN 0, IS IN TURN TAKEN OUT OF
;THE RUN THUS LEAVING TWO DISCONNECTED PIECES IN GENERAL.
; FIRST A NEW SITE FOR THE CHOSEN PIN IS LOOKED FOR BY
;SQUEEZING THE PIN BETWEEN EACH OF THE REMAINING PAIRS
;OF PINS. THEN THE TWELVE WAYS OF RECONNECTING THE PIN
;AND THE TWO PIECES ARE TRIED. OF ALL THESE, THE MINIMUM
;CONFIGURATION IS PRESERVED AND THE PROCESS IS REPEATED
;ON PIN N+1. A PASS TERMINATES WHEN ALL PINS HAVE BEEN
;THUS EXAMINED. IF ANY IMPROVEMENTS WERE DISCOVERED,
;ANOTHER PASS IS MADE.

PHS2:	SETOM IMPRV3		;SET FLAG TO GO THRU PHASE 3
PHS2A:	MOVE A,NUMPIN		;START THE PASS WITH HIGHEST PIN
	SETZM IMPRV		;CLEAR THE IMPROVEMENT FLAG

PHS29:	HRRZ T,ENDS		;START AT ONE END OF THE RUN
	CAMN T,A		;ALREADY FOUND THE REMOVED PIN?
	HLRZ T,ENDS		;YES, SO START AT THE OTHER END
	HRLOI B,77777		;SET BEST DISTANCE TO INFINITY
	MOVEM B,MINLNG
	MOVNI TTT,1		;T HAS THIS PIN - TT HAS
				;NEXT PIN - TTT HAS PREVIOUS PIN

PHS26:	HRRE TT,RUNLST(T)	;FIND NEXT PIN
	CAMN TT,TTT		;FOUND PREV. PIN INSTEAD?
	HLRE TT,RUNLST(T)	;YES, SO TAKE OTHER PIN
	CAMN TT,A		;FOUND THE REMOVED PIN?
	JRST PHS20		;YES, THE ENDS OF THE 2 PIECES
				;ARE NOW IDENTIFIABLE
	SKIPGE C,TT		;FOUND THE FAR END OF THE RUN?
	JRST PHS21		;YES, GO CLEAN UP
	MOVE B,T		;COMPUTE DISTANCE COST IF PIN
				;SQUEEZED IN HERE
	CAMG B,C
	EXCH B,C
	MOVN D,@PTRTBL-1(B)	;DISTANCE SAVED BY BREAKING
				;CONNECTION BETWEEN NEIGHBORS
	PUSHJ P,PHS22		;ADD IN 2 NEW LEGS GENERATED
	CAML D,MINLNG		;MORE BETTERER??
	JRST PHS24		;NO, GO TO NEXT PAIR
	MOVEM D,MINLNG		;YES, SAVE NEW RECORD
	HRRM T,BSTSPT	;SAVE THIS PAIR
	HRLM TT,BSTSPT

PHS24:	MOVE TTT,T		;THIS PIN BECOMES PREV. PIN
	MOVE T,TT		;NEXT PIN BECOMES THIS PIN
	JRST PHS26		;REPEAT
;		PHS22, PHS20
;PHS22 - SUBROUTINE FOR PHASE 2
;ADDS UP THE DISTANCES FOR THE TWO LEGS PUT IN WHEN A PIN
;IS SQUEEZED IN BETWEEN TWO NEIGHBORING PINS

PHS22:	MOVE C,T		;ADD IN LEG FROM THIS PIN
	PUSHJ P,PHS221
	MOVE C,TT		;ADD IN LEG FROM NEXT PIN
PHS221:	MOVE B,A		;GET OTHER INDEX
	CAMG B,C
	EXCH B,C
	ADD D,@PTRTBL-1(B)	;ADD IN APPROPRIATE DISTANCE
	POPJ P,			;RETURN

;PHS20 - A PIECE OF PHASE 2 LOGIC
;COMES HERE WHEN THE FIRST OF THE TWO DISCONNECTED PIECES IS
;SCANNED. AT THIS POINT, BUT NOT BEFORE, THE FOUR ENDS OF THE
;TWO PIECES ARE IDENTIFIABLE. THE MINIMUM WAY TO HOOK
;UP THE TWO PIECES WITHOUT INVOLVING THE REMOVED PIN IS FOUND

PHS20:	MOVE TT,RUNLST(A)	;THE NEIGHBORS OF THE REMOVED PIN
				;ARE THE CUT ENDS OF THE 2 PIECES
	CAIN T,(TT)	;MAKE THE END ALREADY FOUND
				;BE IN THE LEFT HALF
	MOVSS TT
	TRNE TT,400000	;IS THE SELECTED PIN AN END?
	JRST PHS201		;YES, WE ARE DONE
	MOVE TTT,ENDS		;GET THE REAL ENDS
	ROTC TT,22		;PUT APPROPRIATE ENDS TOGETHER
	MOVEM TT,SEG1		;SAVE ENDS OF 1ST SEGMENT
	MOVEM TTT,SEG2		;LIKEWISE THE 2ND SEGMENT
	PUSHJ P,PHS25		;FIND THE MINIMUM LINK TO
				;HOOK UP THE TWO PIECES
	MOVEM D,LNKDST		;SAVE THE RESULT
	MOVEI D,0
	PUSHJ P,PHS23		;FIND THE DISTANCE SAVED BY
				;CUTTING THE CHOSEN PIN OUT OF
				;THE RUN
	MOVEM D,SUBTOT		;SAVE THIS RESULT
	HRRZ T,TT		;CONTINUE TO THE OTHER SEGMENT
	MOVE TTT,A
	JRST PHS26
;		PHS201
;PHS201 - A PIECE OF PHASE 2 LOGIC
;COME HERE WHEN THE SELECTED PIN IS AT AN END

PHS201:	SETZB D,LNKDST		;REMOVING SELECTED PIN FORM 1 PIECE
	PUSHJ P,PHS23		;FIND DISTANCE SAVED BY REMOVAL
	MOVEM D,SUBTOT		;SAVE THE GAIN
	HRRZ B,ENDS		;TRY THIS PIN AT THE OTHER END
	CAMN B,A		;OTHER END FOUND?
	MOVSS ENDS		;NO, SO SWAP
	HRRZ B,ENDS		;GET THE OTHER END
	MOVE C,A		;GET THE LENGTH
	CAMG B,C
	EXCH B,C
	MOVE D,@PTRTBL-1(B)
	CAML D,MINLNG		;IS THIS THE LOWEST COST?
	JRST PHS202		;NO, GO FINISH UP
	MOVEM D,MINLNG		;YES, SAVE NEW PARAMS
	MOVSS D,ENDS		;MAKE IT EASY TO UPDATE ENDS
	HLROM D,BSTSPT		;SAVE NEW LOCATION FOR THE PIN

PHS202:	MOVE D,MINLNG		;HAVE WE FOUND A REAL IMPROVEMENT?
	CAML D,SUBTOT
	JRST PHS28		;NO, TRY THE NEXT PIN
	SUB D,SUBTOT		;COMPUTE NEW RUN LENGTH
	ADDM D,TOTDST
	PUSHJ P,TKOUT		;RECONNECT THE RUN
	MOVE B,BSTSPT
	EXCH B,RUNLST(A)
	SKIPL B
	MOVSS B
	HRLM B,ENDS		;UPDATE THE NEW END
	JRST PHS212		;FINISH UP AND TRY THE NEXT PIN
;		PHS25, PHS23
;PHS25 - SUBROUTINE FOR PHASE 2
;FINDS THE MINIMUM PATH FOR CONNECTING THE TWO
;DISCONNECTED PIECES OF THE RUN

PHS25:	HRLOI D,377777		;SET MIN DISTANCE TO INFINITY
	PUSHJ P,PHS252		;TRY TWO OF THE WAYS TO HOOK UP
	MOVSS TT		;TRY THE OTHER TWO WAYS
PHS252:	PUSHJ P,PHS251		;HOOK UP ENDS AS THEY STAND
	MOVSS TTT		;TURN SEGMENT 2 AND TRY AGAIN

PHS251:	HLRZ B,TT		;GET ONE END
	HLRZ C,TTT		;AND THE OTHER
	CAMG B,C
	EXCH B,C
	CAMG D,@PTRTBL-1(B)	;IS THIS LEG SHORTER?
	POPJ P,			;NO, SO RETURN
	MOVE D,@PTRTBL-1(B)	;SAVE THIS DISTANCE
	HRRM B,ENDCON		;SAVE WHICH LINK TO MAKE
	HRLM C,EN@	8!=!A 0wI)+%8
m!&d5‚*J>-"&*2>I‚BN4)n4J: %4
DD (*:3PhTp5HXV$u5	Qh	(q)È0q(D3D	u5!'sqH
I(JYA"C!*)YŒ] d& P!V*g&)U TDNcbjdE NEIGHBOR
	SKIPL C			8=%
AA(A%&Aœ(!+'!A YA&dd$%n<*QRD
QMR:(4(&EJbJV:eQ"HIn"R"zR"h(&*,jB2B"ID$KZQ""Q"&NRrrJ-"VJ8hP&B>QA0HH%nVtbNMJQ&9,r4 !G0HM	
3ˆQ'5E6"jLX8R|d
D8TIxtLQ'4|XTD-(T<DYddD
tM4
Dz8T,-(T94$DT
4,dX:D,"
	pH'94T$,,d
ELXEb„
6#
J)-
I*$<4$z
(T|ihT"
I(h':E<z
	,Z4tD
DD*
8Td,:HT"	b¼I}-D
5,X[$Ltt$-%xXTph'8eXEJ9ydt,:HT"	epQ!PU„
6#ÐYu4*EDdt8J5 H84|m
ZD*(XbI5$h8R¤t$,AQ LHIR"IYtdhqPPM
Z4DR
EE6&pHK:J%JIR$
$,ldLtt
%HZ$u˜Q!l}hT"dYddtq\<ZD$DT	TLtZTj9z5 h!4lDBeX*D} 4|X*
y$B
I*8dLtz1PPL**5"	
3À4t}Dt||DTt}XybJ+xph!5,EE,*Iu H84|m
ZD*IRtZt$}HBdYhu$@Q!$IT"eIzD%AQ MZ9RJD\}ZAK]H4*zZB¤T,HX5$,D
LpQ!l}hT"dYhD|a4l8T$DT
4,dX:D,"*$L$xQPPM
Z4DR
D@Q3QQB33jh(K*ut
A".tj116HT$
3H(0rh	™C"B([r%U3IJu
%‘"B4
ZrH
4YQ"'º4*H(TQ5d3QaQB4ri1%JU3S
:
*!r4h
I(HZhp)è1*H(3D3QaQB2TJ:4
6L,B!sLAQ@2J+B1YQb!v14eH1U*:3HJkC"Ap21!˜
%‘"B2
)"0%È3QaQ@0p)™@1ˆ*#"ATS!+3HJc"T	
lL,G44i	H

53AQB4q*Is()ZUB!qS(t3H	™4Sjh313JA"Ca4f'*3QQTf'B4iyQq(f'"".j:4
IhQ+Š)d
iÈ/j#!!4rr*q()ZUB!v14eD3V$	30Iz"fbS*)_FBe))U($)ÌD]lQiR)h"`j* $iH($ iQFEiÒdh#bH$f`)DD]Ôedh$ ibHP#'Ô#df*iiFET*id%(($YDD]Ó'kP)QbP HAT PHASE 3 CAN DO
	AOSN IIPBV3		;DID PHASE 3 DO ANY GOL~(%'PA!¦Iwe&XAI	AA'Š dA!A@Xm	Š0A%€%*J94zILr1}*RBVAPPh':U$YhBj
Z$HT,TJ1PS\9T 9th	5	(sD3Q
4qH
I(JYH4HTq)É3HJh$Q''jEdU&'gÒiP#'Ô'"kS,P#bS RATED ENDS IN T@E 2 HALVAS OF B.
	
UPDEND:	MOVE C,[XWD 400000,400 00];CODE FOR TESTING SIGN
 $wQ&AŒ)"24*L4(MVN"RA19Y$%NB 4	tt (sD3QQ@33j@)iP"S S		9SWAP ENDS
 I%4Aˆ1	&$wPAŠhP&Rt)²*:2N "H8TM$4D
p1sDR5	ÙOh(UH4gØ3QaQB4j	H".v(ZkHZ*a'E*`"g]Sgk S B			9JO, @,AŠŒA„0A'/@$w)ž,A)$A1Aa(A)5
!%4AY	Lw	=(A(AQA&AŠ#+0
AŠ0QR()	8AY%U'¨!Rw%&A)%&A)A%0A®~4%M(A+!b$wX(AU'(AA)Š)HAI%A„1	&$w%AŠ/))
A9.A9A!A@Xm%)+Il!Ldnm!&d\@ZA'U%+Q
A$A!!'
@Hw8A(XAA&dn)LA)Š)/AM9)&A8A'A!%Q+$w=%Q)8XA9)LA)Š)/AALAˆ)
AMA!4wQAA1 XAQ%/LA+¨)
A1M(A9Aœ)
A1 \)4w)A%))%AAŠA)!
A!&A%&A'/%)Aˆ)
AA%M&wI!Q\AQ
A'5M(A%M+(A%&AA(\4!¦Hnt!U'A@Y!¦Hnhm)%2@HAAQ
@h%9))=&%-'LA'ŽHw)I2A)A)$@d)!&d\ht!U'A@Y!¦Hnbm)%2AQ&A=%Q)8=-'&AMb$w)8A)%²)!$4!¦HnbtM)5„Y($w¤)(A')9
A9A`1$A)¨1'b$w1+Q
A9A%'+)LA(m'Š)¦–&A='P1A)¨1'd4%IA))PY'ŽHI%4A†1'b$w9¨!AQA)%&A!U'A@Y!¦Hndm(A')9
A9A5!%
4%I4AYMd$w9(AAA)<A)$AI%A)Q(Y'bw˜%'+1(AŒ \\\(!+'!A YA&dnHw(A	M)Aˆ!%
%%´Y'bw(@dA	&AQ)!$%%´Y'd!%$A)PY'ŽDw%AI'+Q&AŒ \\\(%˜)(Y'd%-Š))(YQ(A+'” Y!Ldnf$w¨	')
AA=!% BIGGEST LINK
	CAML D,MINLNG		;IS THIS THE BEST SO FAR?
	POPJ P,			;NO, RETURN
	MOVEM D,MINLNG		;YES, SO SAVE RESULTS
	MOVEM TTTT,ENDCON
	MOVEM G,BSTSPT
	POPJ P,			;RETURN

PHS272:	MOVE B,A		;PICK UP OTHER INDEX
PHS273:	CAMG B,C		;GET DISTANCE
	EXCH B,C
	ADD D,@PTRTBL-1(B)	;ADD INTO TOTAL
	CAML T,@PTRTBL-1(B)	;BIGGEST SO FAR?
	POPJ P,			;NO SO RETURN
	MOVE T,@PTRTBL-1(B)	;YES, SO SAVE THIS DISTANCE
	MOVEM TT,TTTT		;SAVE RESULT
	MOVEM TTT,G
	POPJ P,			;RETURN
;		TKOUT, PUTIN, CNEND
;TKOUT - TAKE OUT
;SUBROUTINE TO CUT A PIN OUT OF THE RUN

TKOUT:	HLRE B,RUNLST(A)	;PICK UP ONE NEIGHBOR TO CUT OUT
	PUSHJ P,.+2		;DO IT
	HRRE B,RUNLST(A)	;PICK UP THE OTHER
	JUMPL B,CPOPJ		;DO NOTHING AT AN END
	HRRZ C,RUNLST(B)	;CLOBBER RIGHT HALF?
	CAMN C,A
	HLLOS RUNLST(B)		;YES
	CAME C,A		;CLOBBER LEFT HALF?
	HRROS RUNLST(B)		;YES
	POPJ P,			;RETURN

;PUTIN - PUT A PIN BACK IN

PUTIN:	HLRE B,RUNLST(A)	;GET THE COMPONENTS OF THE
				;BRIDGE TO BREAK
	HRRE C,RUNLST(A)
	PUSHJ P,.+2		;RECONNECT ONE NEIGHBOR
	EXCH B,C		;DO SAME FOR OTHER NEIGHBOR
	JUMPL B,CPOPJ		;DO NOTHING IF NEIGHBOR IS END	HRRE D,RUNLST(B)	;CLOBBER RIGHT HALF?
	CAMN C,D
	HRRM A,RUNLST(B)	;YES, SO DO IT
	CAME C,D		;CLOBBER LEFT HALF?
	HRLM A,RUNLST(B)	;YES, SO DO IT
	POPJ P,			;RETURN

;CNEND - CONNECT ENDS

CNEND:	PUSHJ P,CNEND1		;CONNECT ONE LINK
	MOVSS T		;CONNECT THE OTHER WAY
CNEND1:	SKIPL RUNLST(T)	;END MARKED IN LEFT HALF?
	HLRM T,RUNLST(T)	;NO, SO CLOBBER RIGHT HALF
	SKIPGE RUNLST(T)	;END MARKED IN LEFT HALF?
	HLLM T,RUNLST(T)	;YES, SO CLOBBER IT
	POPJ P,			;RETURN
;		PHS3
;PHS3 - PHASE 3
;THE RUN IS BROKEN IN TWO PLACES TO FORM THREE PIECES. THE
;THREE PIECES ARE THEN RECONNECTED IN ALL 24 POSSIBLE WAYS.
;ANY WAY THAT PROVID@&AA%	U)8AAI+A RB&M\*BQhQnR"*BJ>=5\*BM"JZ>‚$Bt"M>2R"""J*B&*L4)\
:|r2eb>

-MB|J:R^",q9J6BJ}26u!&M2>F:"p4(4U"MÍPJNRTi&6YL$KZ"R"*&6BzZ6,rQd
4*BMMÁP&6>4)2,rL$KZNQ*ARD)&:M"&1N<j:Rh(&"b5eDHInN;	&M""bRlzNQ	&84PJ"22j2N,9L$%]M>:RJ:M‚$BŠJ"RlzNQ	&:LhP&N$z5HH%n,j6e-‚z&:R->R"hP$$$KZ&J!4
:hP&N%R56Lr2:HInN":QJ6BJ}26u!R= 4(&*N")2B"@$%\:=z21""‚<zJ,4PJN.&a2lJ:2:8H%n^9J6BJ}26u!>,r|4PJB>BRA0$HIn:=bN=‚*&P4PJj2R}"NPHInVB$
R‚$BR}"1$JNRt4(LBJJi2N;$%î*22J
JYR"*JV9J:R=4(&DbJibNH%n6ZRD)&Q- 4(&*N")2|p4(&EJibNH%n6ZRD)>RD*I- 4(&EJibNh(&B-")‚b>ph(&6}2QdbNH%nJ,>::,QRD)B&,MLrR=
2>> h(&"daQ2eHhP&BVB)Ad:: h(&6}2QdbNh(&"daQ2eLhP&BVB)Ad:: H%n6ZRD)Nz: "	ItXQ!l}hT"dJ8T;˜Q!DdD
Bde8Xsh!-œ	$d9hTd 4dz8R¤Td|zPPLYzd*%HDtX:@HK9iu**(TZ
I*
}
)$T	DLt1Q LE*+"HYd%˜5$*BD$hd-YjB,hDt-
D$LXQPPL8b5EHQ!l}htdC"B)ÙuQ3$K3HJb".jI4h*Q02dStS*4$	Q5hYQc!!2K$kAQ@2J+ThAQ@4*9HÈssAQB4q*Is()ZULa.p
"S&*$P+gi"*$P#ggQ'"kÔFEe”)j()YXEDBh$)YÌ($YXEŽh$)YÌP H+i h"b&eh#“i($YXEŽh$)YLP H)ja)“jj$gP#'i($ iQPFEŽh$)YL!laS"iP*)'jcR P(iida"P AIRS OF PLACES TO BREAK THE
;RUN. PHS31€&A)A)I2A)A/3LA)AI9(AQ 	,Z5`hS82yyb4
E6i3Qd3H)ZSuHY13UDf6Q*J4STaQNqd
(
ItZQ3AQA"T	
ll@d))&H!)bQYD]Uh" jP*$"H"g"c)bQfbg*ER))&PV)bcÌDD]febkdTbP)bQYFEP`fcP!DDNc$g"*$"P$ij S!bP)Pk"b,FEQl!d!DDNd`edS!P*$P*+gH!jj)CE fgÕ P"(*)*&XTFER))-)bcLFEd)-!K)bcYE a`ScP!FEbV!d!!FEPb"" (*)!&XJ!FEfgk"SP")Ua*'jD]`AVE THE SAVINGS
	PUSHJ P,PHS31		;DRY RECONNECTING
	SKIPGE MINLNG		;IMPROVEMENTS?
	POPJ P,			;YES!
	MOVE A,SEG2		9SHRINK SEG3, EXPAND SEG2
	HRRZ B,SEG3
PHS33:	HRRE C,RUNLST(B)	;GET THE NEW END FOR SEG3
	CAIN C,(A)		;GOT THE WRONG LINK?
	HLRE C,RUNLST(B)	;YES, GET THE OTHER
	JUMPGE C,PHS32		;SEG3 SQUEEZED OFF THE END?
	MOVE C,SEG1		;YES, SO EXPAND SEG1, MAKE SEG2
	MOVS A,SEG2		;BE EXACTLY 1 PIN, SEG3 BE THE
				;REST
PHS30:	HRRZ B,RUNLST(A)	;GET THE NEW END FOR SEG2
	CAIN B,(C)		;GOT THE WRONG LINK?
	HLRZ B,RUNLST(A)	;YES, GET THE OTHER
	MOVS C,ENDS		;IS SEG2 SHOVED ONTO THE END PIN?
	CAIN B,(C)
	POPJ P,			;YES, SO WE ARE DONE
	HRRM A,SEG1		;UPDATE THE NEW END OF SEG1
	HRLM B,SEG2		;LIKEWISE SEG2
	JRST PHS33		;TIE DOWN THE LOOSE ENDS
;		PHS31
;PHS31 - SUBROUTINE FOR PHASE 3
;PHS31 CYCLES THROUGH THE 8 PERMUTATIONS OF THE THREE
;SEGMENTS BY FLIPPING EACH SEGMENT IN TURN IN A BINARY
;SEQUENCE. IF A SEGMENT CONTAINS ONLY 1 PIN, THE SEQUENCE
;IS SHORTENED BY NOT FLIPPING THAT SEGMENT.
;PHS313 CONNECTS THE RESULTING PERMUTATION INTO A LOOP ANDS
;FINDS AND THROWS AWAY THE LONGEST LINK.

PHS31:	MOVE T,SEG1		;TRY SEG1 UNFLIPPED
	PUSHJ P,PHS311
	MOVSS T		;FLIP SEG1 AND TRY AGAIN
	CAMN T,SEG1		;BUT NOT IF SEG1 HAS 1 PIN
	POPJ P,
PHS311:	MOVE TT,SEG2		;TRY SEG2 UNFLIPPED
	PUSHJ P,PHS312
	MOVSS TT		;FLIP SEG2 AND TRY AGAIN
	CAMN TT,SEG2		;BUT NOT IF SEG2 HAS 1 PIN
	POPJ P,
PHS312:	MOVE TTT,SEG3		;TRY SEG3 UNFLIPPED
	PUSHJ P,PHS313
	MOVSS TTT		;FLIP SEG3 AND TRY AGAIN
	CAMN TTT,SEG3		;BUT NOT IF SEG3 HAS 1 PIN
	POPJ P,

PHS313:	MOVNI E,1		;SET LONGEST LINK NEGATIVE
	MOVN A,SUBTOT		;START COMPUTING NET GAIN
	MOVEI B,(T)		;GET LENGTH OF 1ST LINK
	HLRZ C,TT
	PUSHJ P,PHS34
	MOVEI B,(TT)		;REPEAT FOR SECOND LINK
	HLRZ C,TTT
	PUSHJ P,PHS34
	MOVEI B,(TTT)		;REPEAT FOR THIRD LINK
	HLRZ C,T
	PUSHJ P,PHS34
	SUB A,E			;THROW AWAY THE LONGEST LINK
	CAML A,MINLNG		;IS THE IMPROVEMENT REALLY?
	POPJ P,			;NO, TRY AGAIN
	MOVEM A,MINLNG		;SAVE THE SAVING
	MOVE A,[XWD T,LSEG1]	;SAVE POINTERS FOR RECONSTRUCTING
	BLT A,DCNECT		;THIS SOLUTION
	POPJ P,			;TRY AGAIN
;		PHS34 DCON
;PHS34 - SUBROUTINE FOR PHASE 3
;PHS34 FINDS THE EAXIMUM LINK FOR PHS31 AND ADDS UP THE
;LINKS AS IT GOES ALONG.

PHS34:	CAMG B,C		;GET LENGTH OF THE SELECP	ˆ41AY=-
Aˆ1!)%QZb!R%	AY$w+U)Š)
A')9&(AY
$w¦)¦)
A1M(~%!!” X$wX	A=)=-
AŠ1we&XAM-
AQ&A1) IAYwM-
AA)%&A=$A)I/=-
A)Q)(Y$w)%&A9A/2A!A@X(w	8@ZA	%'9((w%&A)!
A9)%A)/8A)/ž!¦2A!9A)A-&wQAA!9)%&4	tA+'” Y	=bm%,AŠ!Q$%1Y$w%A)A)$	bt%%%´Y%+9'(QRwLA)Š¨Œ)
AY)4~AY%		;NO, CLOBBER THE RIGHT HALF
	CAME A,C
	HRROS RUNLST(B)		;YES, CLOBBER THE LEFT HALF
	POPJ P,			;RETURN
;		STORAGE
;TEMPORARY STORAGE

NUMPIN:	0			;THE HIGHEST PIN NUMBER READ IN
ENDS:	0			;LEFT AND RIGHT HALVES CONTAIN
				;THE TWO ENDS OF THE RUN
TOTDST:	0			;THE CURRENT LENGTH OF THE RUN
LSTLNG:	0			;THE NUMBER OF PINS INCLUDED
PHSSW:	0			;A FLAG FOR PHASE 1
LNGMIN:	0			;SHORTEST LINK FOUND IN PHASE 1
LSTCND:	0			;CURRENT CANDIDATE TO GO NEXT
				;INTO THE RUN
LSTEMP:	0			;TEMPORARY FOR LSTCND DURING
				;THE SECOND HALF OF PHASE 1
IMPRV_PHSSW			;A FLAG FOR PHASE 2
MINLNG_LNGMIN			;CHORTEST ADDITION TO THE LENCTH
				;OF THA RUN FOUND IN PHASE 2
BSTSPT_LSTCND			;BEST PLACE TO SQUEEZE IN THE
				;SELECTED PIN
LNKDST_LSTLNG			;LENCTH ADDED BY BRIDGING
				;ACROSS CUT ENDS
ENDCON_LSTEMP			;DHE TWO ENDS TG BRIDGE ACROSS
SUBTOT:	0			;DISTANCE SAVED BY CP))%A)!
$w€*2$*BLq>V">‚$BJ,p4*N,9Eh% H$%n$BR<y:%>z:|1R"*VPhP$$$KZB&*L4**IhK $$%]""‚%:=t"M>2R"zR"B&(4*N,9N~
"NBPHH%nRD)NJ"Nl*:Q4zIBD
Nh*2N,9Eh% H$%n$BJ,>66,rJ6-"R&|p4*2*IhK $$%\20
	T0hTJ8T;›! HH5brpQ(DtX:CPKK]IR¬j(T|YXTt$XD|ihT¤y`hTZ37! H4Lm
)u4,XYe"iH:iz"„4*1Q$LTIE}:X%$}AK]HYUIx2-8XB4z$d|zLtE`hPQ*4%'! H4}YjD-iujYT-$	t25ZLu1Q$DtIz5;ÐHK8iD:iud"z(D-XD¬j1PU:
EÐ	tLuD2e„hH$bDUC¸8%M$T
%
Iršx4u¬X(Uh)z$%J' M„ye"EuH)BD*F K:	tLuHZ"¤t	u$Z$|HQPPc1$)HUh!Q#]J*DbT|jD-
HdQQ#]$)D*xd|jD-4d}
	uIyR$zX$d*	d$-3HtsH
I#"GºR0)èu3*$4jH3Pq$	05IH(8u35)H5tDh5*:*h(Q"NtiX3*$3D	U30HZKH(d0h	4h	ˆ(u	ˆ4H	™HU)XQ4K
Q1Q*!"Nu	t$4uPq(
H0S$V($	3uQ$
JUSV*0e•C"C!*U)B1IzH7f06
,#"A—kI4uIEr*J	l*+f!"OC!*U&7t
*S&"C"G¸4u)(I4u)hq(S#!'p(
)03QjY4H	X5R+qH
I(YQu	qHiQ(HZ524HX"NjIhsiéQ0u3
	ttr()(4Th	øH)jkHIúh(	4h	u3H8#"Nh(5q(YH)jh+&SjtHh*:3PhTQ5
x13H
	3Th%,%,+!'tSudh*4k,Dk,%Dk,ED5eá"Nq	uS
t0hT4h
H2q3DTSs$
(jQ1(
:0q$5IxQQKAQC"Q	uS!0Sh9h0+

J(
l%•lB.htq3()()dStD	Suc!¡"Nt	êST3D
0SQ"NpiùU2)jh)dr)ê4TeDTpjDH3Hikj(4H53HD04I4R5QNpR*Jh&TTpjDHrTc"G8R5dK,-D	tQ*$c"G8R5h0*)hR*A"NpIšh'…,m(
	3H	y3U*!"C"J	US!0Sh9h0+
"T	êS'!0Sh9h0+
"T	êSG!0Sh9h0+
"C!'tU3IJu$
U3H	I4u!'p(S(	øHi™U4J4Q4
(4q3JI3Qh
I(j(4H	™Hr	r	tr4HQ"Np$
U3KD
(	äuYUV$	4h
I(
yhQ)˜rSj*hqD
3H	d3C!'u$
R1r
D3Q	1U	3HZkH&10)jhT3Q	qHJYKC"AQTU3IJuB()prd	066#"C
:0U	A4Su*H4H)ê4QHq(jXTTc!'tu0J)u5)è4h	t3UZQP0hTs
y5
)u5*!"C"G:Su5	™Q(	tR3	DU)r*IIz4HYUR(ZhSj$Su*I3Qc!'pp3	Dr5	r)ê4H
Ihr*((3D
kITu
	3H)d"Jy4Tq*GB33jh2(eJUIÅ,""':4rIusH
	r3UZHSj$3J1"B3)úQ2(e06
"Ur**u.A˜Q5iIIš
#"AšSQ$
J4"ATTu
r4TjH"B*
4rD
r**u!qtSiihsHT3AQB4j	HQUr4J:B(h5r		k
!QB2U)ZHÊr4TjF#"UiTu'!2K$kaQB4si©(eHtt	!".ti94
)5R0)DU3J1"B3)úQ3(uU3*	3C"ATTutt	&#"C!ªr4TjJB4iySEHtt	!".s	zq((dU3D	u5	øHtq#"A4r	$H304.qSh3HD04
3H!QB5	tJQ4T	™B".iX4Rhh4J)tC"A4rk
A".tjItQ(i1td3Q
	3H	y3U*$3H
80ssHH4V(
H0S!QB33jh3(%JUIF+4JHS
e‘"B3)úQ3(%U)K4	êS
u#"B)*Tu:tF"C"Ih330*B2J+H
E"I˜SHÇ.q	ùIu

5iùThj$u5

5h3HDqH
*3C"A˜Q5iJ4‘"B2JY4(
EqQ*Hr
IHK*#"A1Q59

EPR*E#"B!šSQ$
pIø#"A5d
!.v1*1"B")*Tu
	P31+Ñ"B1HZr

E
R5
!QB5Iè(	ú5QB5	tÆ".k˜4k	X4RhhsjZPq#!§Nr1Id"J	P31'!1Q59
K
J(*"'8Sq$
r3JH4C"A˜Q5i
J	™SJ#!*P3(ZB1HZr
KIÉpj#!!1Q59
%PR*E#"B)ª34$+t	zB"'83V(	Époc!!5SHTJy3!ur3Gc"B*	tH
""';14kp3IjDSu*H#"B*JSQ(
EpShK"".h9sOc!!2TTjDP)Ø,c"AšSQ$
&F-B"'¸U1hT3Dh1D-	™H*3HH)dspi¸5"A3rP$
	h31-QB5IéH
&--AQB2TJ:H1-#!!0p2)È(Æc"B((
JC!!5h+	Ê4lC!*P3(VB5	Éh+
	4l!QTP)Ø-.B(JH
Eti™UEH+-kÑ"B1HZr

JKI4
!QB2U)Z(
Etj	B".iÉtq(	˜HSd4H1C"A˜Q5iK
EIe#"B*JSQ(
E-H4L&F-B.i˜Hq$zQ()JQ01sHT$	04	™Qc"A™3uQ)K&B".iX2q(	šiyh)¸(-D
3HI4"ATTutt	&#"C!*P3(VnB1
HKtr)ê,EH+m+Ñ"B5	Éh+	X4sia".s(Rh*4ssIè0uj$3AQB33jh2(EÇ,-B!u*44d
hHTsh
I5
8sui…1S+ssIè0uj*hr*I"B!".uišItp4HD3J4p3DQ(iQ1
Ih*uhZH3HDtSjYQ"A"".j	3TkD*4p5*84h	ˆ(siZ4R*9sH*D4tJhd
r3H!QB2TJ:t	zL#!¡"TU)èR6A™3uQ)+&"B2
*VHEÈ3QaQTU3Hk.B)‰VH5U3IJu
E‘"B0h1(eH"".hIq4h	È1U	3H
	r3U
huc!!33uJ:hU)éu
%"".iékjx4"A™3uQ$+C!!2THTKJYSuJ#"AU34x(K
*3QV".piùU3JX(d	u*$3Q	qHJYC"B*	tH
"C!©SrHGB,!©tQIÈnB,".o0V$	tQ*$3AQB""!o(Su5Q"B"!.oH0V(	zQ4Dc"C!+S5IgB,!.vH	È5Q3StH
*3C"J(63IGB,!.vH	È5Q3
4q1V(H3idSu*I3Q4aQR3Piˆ4nB&"".jIu3
r4Q$	3QjI0h:3531	ˆ4Q#!ªr4Q)ÉNB,".sYQu	qHiQ(J)s(		4h	™Hd	Q6QSUr*(4nB&"".iê30Q*$qH
y4Q4aQSTU)jnB,".sJY0Q4D	qHiQ4c!ª3Pi
nB,".u	ú3	ê30Q*$qH	™Pr*4qH
y4Q#!¡"Ur)ètA""':0hThyhTIù(SjZr4H	ùHr)á"Sj8tA""'1(B"$	zq#"HhtA""':0hThyhdR3Q
tH	zHsHA"QPIšB,".pIšd
4u	3H	™H*(R*JhqD4H1HIzHj$tHyQ"AQTp5IB,!*p5Ug!,"AQTq
:B,".t	H0q(
Ih*:5ihjSs(
tt(1"Th)5B&"".h)5hT4Q$
4u	™Qh)dtj0c"AQPtiJuB&"".iI4u	øHp*(jx4Hj$tSjYQh
x(r)É4hQ"Sj8SnA""'º4d
U3H	hj93Qk	q14ssXu3HtU5
R3JD4h	Étq4AQCb!Su5ZHq*J4	étS0)DU3AQTvKC"TIú5tLG!33uHY(©5T
q"B3)úQ3(
Er3HJt"A™3uQ)j	tC!!33uHY(	Étqj B2J*uIú5r4AQC"TJv.C!©Sps*U4
ZrH
ti˜hC!*Su5j&.B3)úQ2(
ESu)jC"A™3uQ)T	zqtQ@fgÕ"dP*)'jh*ESgk"fH*+dS")hB)'jkRifSk"fPV)`k•DD]j"ibPi"P*Tbb!P)'jU"iEfgk"SP )Pk$Ec"j!R*$+a$j
DD]cQj+dT"P!$U)FEU)'"P)h+Ôicg]h+Ô'ig")gFEe))j)'jhDD]lQiV)“hj"P$c#"T"g*&FEiQj-&P!$jB]af"Pi*$iP#'Ô()$S*)'Uj$g"CEc"U!d$$+hgDDNibj*'P$i)j($gc)*S#'i+di)QjET*id%(+dT)bjBe))U-FEi'jfkfSk"P$)`k$E 		MOVE W,SAVW
		JRST @LOSDSP]
	PUSHJ P,ROUTER
	JRST [	OUTSDR[ASCIZ/BARF, SOMEONE CALLED ROUWIR UITH SINGLE PIN RUN!
/]
		JRST ROULEV]	;IGNORE 1 PIN RUNS
	AOS NRUNS		;CMUNT A RUN ROUTED
	PUSHJ P,RUNFIX		;NOW FIX RUNLST POINTERS
ROUWIN:	MOVE H,SAVH 5-
A\Y'-\I'(A]	'@v$%+Q$A')+ X!/HA$A%+A%+4wQ$A%
A('(AQA'!SGND TO DO PWR OR GND ON DIPS ONLY (NO RUN EXISTS)
PGZN:	MOVEI T,ZLEVPW
	MOVEI TT,CPOPJ
	JRST ROUPGZ

RPGN:
NOCMU,<	PUSHJ P,PGSIG >
	MOVEI T,ROUPGP
	MOVEI TT,ROUNPN
ROUPGZ:	MOVEM T,WINDSP
	MOVEM TT,LOSDSP
	MOVEM W,SAVW
	SETZM SAVH
	MOVE T,PGBIT
ROUPG:	TRNN T,SPWR		;WHICH?
	JRST [	MOVE T,[GND,,FGND]
		SKIPN WIRGND
		TLZ T,GND		;NO BITS IF NOT WIRING
		JRST ROUPGF]
	MOVE T,[PWR,,FPWR]
ROUPGF:	HRRZM T,FDSP
	HLRZM T,FBIT
	SKIPE B,CPGLST
	PUSHJ P,PUTFS
	SETZM CPGLST
	HRRZ A,H
	PUSHJ P,CLEARA			;CLEAR PIN MARK BITS IN RUN
	PUSHJ P,FNDONE			;FIND A CARD PWR OR GND WE WILL NEED
	JRST FNDALL			;FOUND ALL
	MOVEI T,CPGLST
	JRST FPGLP1

FPGLP2:	CAMN A,ADDR(T,PNAM)		;DO WE HAVE THIS ONE ALREADY?
	POPJ P,				;YES, CO-ROUTINE RETURN TO FNDONE
FPGLP1:	MOVE TT,T
	FETCH(T,T,NWRD)
	JUMPN T,FPGLP2
	GETFS(T,WBLK)
	STORE(B,T,PNTR)			;STORE PINS
	STORE(A,T,PNAM)			;STORE PIN NAME
	CLEAR(T,NWRD)			;CLEAR OUR LINK OUT
	STORE(T,TT,NWRD)		;STORE US AS LAST LINK OUT
	POPJ P,				;CO-ROUTINE RETURN TO FNDONE

FNDALL:	SKIPN T,CPGLST			;ANY CARD PINS LEFT?
	JRST ROUSOM			;NO, NOW CATCH ALL THE UNROUTED PINS IN RUN
	SETZM LOSFLG			;NO LOSE YET
	FETCH(TT,T,NWRD)
	MOVEM TT,CPGLST			;TAKE US OFF LIST
	FETCH(TT,T,PNAM)
	FETCH(TTT,T,PNTR)
	FSTRET(T,WBLK)			;RETURN FREE BLOCK
	MOVSI T,RPGPIN			;MARK AS GENERATED PIN
	MOVEM T,PNTBL			;PUT CARD PIN IN TABLE FIRST
	MOVEM TT,PNTBL1
	MOVEM TTT,PNTBL2
	MOVE G,[1,,PNTBL]		;ALREADY STORED FIRST ENTRY
	MOVEI F,MAXP-1			;COUNT DOWN NUMBER OF PINS (DON'T COUNT CARD PIN)
CMU,<	TRNE DOROUTE			;Don't print header unless .WLR
	PUSHJ P,PGSIG			;We like a header on the top of every page and signal name with every wire
>;CMU
	PUSHJ P,FNDONE			;NOW FIND THEM AGAIN
	JRST RUNEND			;DONE, NOW ROUTE IT
	TLNE TTT,RPGPIN			;IS THIS PIN IN A RUN
	JRST ISRPG			;NO, IT IS GENERATED
	FETCH(T,H,PBIT)
	TRO T,PTMP1			;MARK SO WON'T BE DONE LATER
	STORE(T,H,PBIT)			;MARK AS DONE
ISRPG:	CAME A,PNTBL1
;DOES THIS REALLY BELONG  ITS COMPARES # OF PINS ON DIFFERENT ICs	CAME B,PNTBL2			;SAME CARD PIN?
	POPJ P,				;NO
	SOJL F,FNDLOS			;TOO MANY?
	PUSH G,TTT
	MOVEM C,PNTBL1-PNTBL(G)		;STORE PIN NAME
	MOVEM D,PNTBL2-PNTBL(G)
	POPJ P,				;CO-ROUTINE RETURN, FIND ANOTHER

RUNEND:	PUSHJ P,RUNEN1
	JRST FNDALL

RUNEN1:	SKIPE LOSFLG			;DID THIS RUN LOSE ALREADY?
	JRST FNDLOS			;YES, LOSE AGAIN
	PUSHJ P,WIRSTE		;END STUFF
	JRST ROUPGE		;LOST (ONE PIN RUN, CAN'T HAPPEN)
	PUSHJ P,ROUTER		;NOW ROUTE IT
	JRST ROUPGE		;LOSE (ONE PIN RUN, CAN'T HAPPEN)
	PUSHJ P,RUNFIX
	MOVE W,SAVW
	MOVE H,SAVH
	JRST @WINDSP		;WIN DISPATCH

FNDLOS:	SETOM LOSFLG		;SET LOSE FLAG
	PUSH P,H
	PUSH P,W		;SAVE THESE
	PUSHJ P,ROUEST		;FIX RUNLST
	MOVE W,SAVW		;SETUP FOR DISPATCH
	MOVE H,SAVH
	PUSHJ P,@LOSDSP		;DISPATCH TO LOSE ROUTINE
	POP P,W
	POP P,H			;GET THEM BACK
	MOVE G,[1,,PNTBL]
	MOVEI F,MAXP-1		;USE SAME CARD PIN AGAIN
	POPJ P,			9CO-ROUTINE RETURN

ROUSOM:	MOVEI G,PNTBL-1
	MOVEI F,MAXP
	SETOM NUMPIN
	SKIPN H,SAVH
JRST ROUPGW
	FETCH(H,H,WPIN)
	JUMPE H,ROUPGWROUPG5:	FEP	!(YYA(R4)%9A(Y+ %)%Š(Y!)5 b
%%'(%+!lMAY%+Q4PJNB>)"Q@EEhP2II(
(4T)aEhid#K$EPeiP'fh$gE 	HRRI D-PNDBL+1(G)	HRLI T,-PNT@ZbB$4PJ6.Z,iQ²*:2N UuH)BD:#"J)u0fg@1Q*Hr
I	V
J
#"AU34	dIzh#ZCE h*Td!()'jbQ,EU&#"PVPDB]`g,U$ g#H)j aÒbbFBe))U)'jS"kDNYES, D@A%( (Lj>@4T	ei hU)zU unB)Yk"PTSAVW
	POP@A@X (hR:|rh uCE 	SKIP@A 
&PhP&*J!:%V 04tzI	eB	*U€d
U3C!33uHTkhUb"'€cbj IRE LIST  $*IB|J:Rh(&-"!‚8E:@pQ"".h)q(
	p3UZA"B)ª34$
iSHJU3B!p3V'ñ"B4hZS 	Jqu.sSd	4u
p'j,bjB)'jhYchCH(T,W,BLOC)		;BODY LOCATAON
 U!
APY%+Arm2~45A(Y1'(4%M(A%U!r(-A(Y1'(4QQ1.Q	A(Rm(A A)e!

%+!AY%=+!r4'Q5A!%$w%(A!8@FA=+)H)Q YY	AR)%+ D`t=&A!9()Q(Y Y!%(Rw(A	e!A%)&%)	(Y%(w%&A¨
A]
A/9(~%%'(%+ Db5%
AQ(Y!9$s!4(Lj>J2\$KZ
>JB>u"H4PJBVNDQA²r6PPL**5")zUL@Q2
3C!!44i	H
	3S0*".pi0rh	˜H0*
h3HDq5R5aQ@e)”j)'UhXFBfgkP!V CE 	MOVA D,B
	PUSHJ P,@FDSP		;FIND THE CARD PIN %)Y!$w	^4J: "
I*	cxh!%D
$}€4$!Q@33jJp(
JTz3B'9`i%H iP#Qg"a U"b(g 
	PUSHJ P,@(P) m˜&A<[%+QhRJ>V	Eh&4*R!DA2!2%:bQHIn,-daB&u4(U*6B9A2J>-E@4U>FB;Ih&-"!¢:b]2:E"	$KZ"Y2b
>L*L4(LRV6Br]2J}*AEHhR:*9h&Z&B9A2N4@$%n<*QJ,qB>LrRHhP&*J!:$rJ8$KZ:>:(h(&-"!"Bb!2^J9$4PJ*V6)!24r:Jph*:%1IHL2BBBRRQdA2B
M!$4(M"J:"RQ2%*@4 !%Ddt)fhP
UD$
dtYT€5%	dlhrMAQ LU*:B4hJ$`& ".iéc"B)ÙuQ(UQ@33jh("B3)úQ(eH#"B*
4rD
)é04!uV$	04	™Qc"ATTuSQIF ".iÉtq#!!44i	HQt.qR)h5
4p4HD3AQ@33jh(
E#"A4r	$
#"HiQSF@c"U!d$$',(FEe*fh$#“ )'	E#'")'TgiP@			;TAKE OFF SKIP RETURN
A!A@XmA=%
4%+'(t5-’(X[!9)QR!%5š(Y&%=+&bh%$A)(X4bQ(R4%IA)¨0bQ(R4YA)PY%+1' Qˆ$ &lzRN 
E"e(Z%LaQ LLz)R%EJu$)E"H8ddtdb
	e2-*)u˜Q!|(xR¢J)u,-6P@L	ID}rHh!}HÁ C"J)u11K@33j@ dP*h'*L(G)
 I5APY	L &EJ>MV:2 4(Db2>MV*2!"QhP&B>QAhP4*J}*R>=PJBVNDQA²zV@h(&B-")‚b2>"N@4PJ*JN J>Vz4$%\"5RD)J:@hP"TIzh#bN	OUTSPR[ASCIZ/ERROR RE@)U%AIyJm
yHT")u-tPR}QQ M„z	"AQ cØ5,$
DjIt=$tyd"*Yei%€Q*=X3@!33uHY(  DSP
 =(
 ,
Beyh@hP4*9((#ihX@
	MH-$A(I'A(H Q*=6@!33uHYP  1! 
M 4( Yu (dP$) b"+V+Ri"aVdPH $ &UN@"j:h	B !'!fh€$!"QdA2^
M!$4 !Etd
BdtPIÀ 		;MH² $*I
dz Z	D,8QP@MHIdrEJ<AK\izTt	yd+øQ!U:@ tp!ÌAd))*(#b)T@
	JRST (T)
!'Adt BB!2d
2B!Hh(&*,jB9@E8f1"B2
*VHJqj e”)jDD]Q$ih U!d*P OT FOUND ROUTINE
	PGSIG:	SKIPL LANCLT
	PUSHJ P,PUTHDRPGSIG0:	MORE T,PGBIT
	TRNN T,SPGR
JRST [	PUTSTR[ASCIZ/GND/]
		POPJ P,]
	PUTSTR[ASCIZ/PWR/]
	POPJ P,
SUBTTL	'WLR'		ROUTING SUBR FOR WIRE LIST OQTPUT
;ENTER HERE FROM WIRLPR
;H IS POINTER TO WIRE, G POINTER TO FIRST PIN
ROUNPN:	SETOM ZLEVN		;DISABLE Z LEVEL PRINT
	SETZM WIRELN		;CLEAR WIRE LENGTH CELL
	ERRSTR 1,[ASCIZ/Too many pins in run/]
	SKIPN G,SAVH		;THIS MUST BE SETUP
	POPJ P,
	JRST WIRLOP

ROUPNT:	MOVE G,H
	PUSHJ P,LOPSET		;SETUP FOR WIRE PRINT
	MOVE T,FBIT
	TRNE T,PWR
	AOS NPTOTAL WIRE LENGTH
	MOVE T,NUMPIN		;GET NUMBER OF PINS IN RUN
	TRNE T,1		;ODD OR EVEN? (0 IS ODD!)
	SKIPA T,[3]		;EVEN, START AT 3 (Z 1)
	MOVEI T,2		;ODD, START AT 2 (Z 2)
	MOVEM T,ZLEVN
	HRRZ G,ENDS		;START AT THIS END
ROUTIO:	HRLM G,(P)		;SAVE INDEX INTO PNTBL
	MOVEI T,4
	SOSGE NUMPIN		;LAST PIN?
	MOVEM T,ZLEVN		;SET END Z LEVEL CODE
	HLRZ T,(P)
	HLRE B,RUNLST(T)	;GET LAST PIN
	JUMPL B,[SETZM WIRELN	;NO WIRE LENGTH ON FIRST PIN
		JRST ROUTDO]	;AND PRINT LAST PIN
	HRRZ C,G
	PUSHJ P,DSTSTR		;CALC AND STORE DIST IN WIRELN
ROUTDO:	MOVSI T,RPGPIN
	TDNE T,PNTBL(G)		;CHECK IF PIN HAS PIN BLOCK
	JRST RPGPNT
	HRRZ G,PNTBL(G)
	PUSHJ P,WIRLP0
ROUTDN:	HLRZ G,(P)
	HRRE G,RUNLST(G)
	JUMPGE G,ROUTIO
	SKIPE SAVH
	JRST WIRERR
	SKIPE LCOUNT
	CRLF
	SKIPE T,INCHES
	CAMN T,WIRELN
	JRST NONWLN
	MOVEM T,WIRELN
	MOVEI A,=48
	PUSHJ P,FILL
	PUSHJ P,DOWLEN
NONWLN:	CRLF
	POPJ P,

RPGPNT:	MOVE T,LCOUNT
	CAIL T,8
	CRLF
	PUTBYT 11
	MOVE A,PNTBL1(G)
	MOVE B,PNTBL2(G)
	TLNE A,MAPPWR		;IS THIS A PWR PIN?
	AOS NPWR
	TLNE A,MAPGND		;HOW ABOUT GROUND?
	AOS NGND
	SETZM TCOUNT
	PUSHJ P,PGPRNT		;CALL CARD SUBR TO PRINT PWR OR GND PIN
BOTH,<
	PUSHJ P,PTABABS		;SPACE OVER
	PUSHJ P,PGPRTM		;PRINT FOR THE OTHER SIDE OF BOARD
>;BOTH
	SETZ T,			;AVOID STAR
	PUSHJ P,PTAB
	SKIPN WIRELN
	JRST ROUTDN
NOBOTH,<
	MOVEI A,=48
>;NOBOTH
BOTH,<
	MOVEI A,=64
>;BOTH
	PUSHJ P,FILL
	PUSHJ P,DOWLEN
	JRST ROUTDN

DSTSTR:	CAMG B,C
	EXCH B,C
	HRRZ T,@PTRTB1(B)	;GET DISTANCE FROM THIS PIN TO NEXT
	MOVEM T,WIRELN		;AND STORE HERE FOR PRINT
	JUMPE T,CPOPJ
	MOVSI TT,RERPIN		;ERROR BIT
	TDNN TT,PNTBL(B)
	TDNE TT,PNTBL(C)
	JRST [	SETZM WIRELN	;IF ONE IN ERROR, FLUSH THIS WIRE
		POPJ P,]
	ADDM T,INCHES
	ADDM T,TINCHS
	AOS NWIRES		;COUNT ANOTHER WIRE
	POPJ P,

NOITS,<
DOWLEN:	MOVE T,WIRELN			;YES, ANY WIRE?
	IDIV T,FRACTN			;MAKE IT INCHES
	PUSH P,TT			;SAVE THE FRACTION
	PUSHJ P,DECOUT			;AND PRINT
	POP P,T
	MOVE TT,FRACTN
	CAIN TT,=10
	JRST [	PUTBYT "."
		PUTBYT "0"(T)
		POPJ P,]
	CAIN TT,=100
	JRST [	PUTBYT "."
		IDIVI T,=10
		PUTBYT "0"(T)
		PUTBYT "0"(TT)
		POPJ P,]
	JUMPE T,CPOPJ
;	Fraction-reducer
	MOVE	TT,FRACTN		; get denominator
FSH:	TRNE	T,1			; even numerator?
	JRST	FODD			; no, reduction done
	TRNE	TT,1			; even denominator
	JRST	FODD			; no, reduction done
	CAIG	TT,2			; smallest denomitor will be 2
	JRST	FODD			; if 2 (or smaller!) then done
	LSH	T,-1			; numerator/2
	LSH	TT,-1			; denominator/2
	JUMPN	T,FSH			; prevent infinite loop
FODD:	PUSH	P,TT			; save denominator
	PUTBYT "+"
	PUSHJ P,DECOUT
	PUTBYT "/"
	POP	P,T			; get denominator back
	JRST DECOUT
>;NOITS
ITS,<
DOWLEN:	MOVEI T,=1000	IDIV T,FRACTN
	MOVE TTT,T		;YES, I KNOW ITS A CONSTANT
	IMUL T,WIRELN		;DO THE FIGURIJG IN THOUSANDTHS OF INCHES
	SUB T,POSTMG		;SUBTRACT OFF POST MARGIN
	MOVE TT,T
	SUB TT,WRAPMG		;THE REAL DISTANCE BETWEEN PINS
	CAMG TT,TTT		;ARE PINS NEXT TO EACH OTHER?
	JRST [	PUTSTR [ASCIZ /BARE/]
		POPJ P,]
	IDIVI T,=1000		;LENGTH IN INCHES
	PUSH P,TT
	SKIPE T
	PUSHJ P,DECOUT		;PRINT INCHES
	PUTBYT "."
	POP P,T
	IDIVI T,=100		;PRINT TENTH
	PUTBYT "0"(T)
	POPJ P,
>;ITS
SUBTTL	'WLZ'		ROUTER Z LEVEL OUTPUT SETUP
ZLEVP:
CMU,<	TRZ DOROUTE	>	;CLEAR THIS FLAG SO WE DON'T GET SIGNAL NAMES ALL OVER THE PLACE
	SKIPN ISWW		;MUST BE WIRE WRAP
	JRST NXWW		;ERROR  NOT UIRE WRAP
	MOVE L,DEFLST
	PUSHJ P,LSTGET		;NOW ASK FOR PARTICULAR CARD!
	POPJ P,
	FETCH(T,W,WIRES)
	JUMPE T,[OUTSDR[ASCIZ/No wires!
/]
		POPJ P,]
	MOVSI T,'WLZ'		;WIRE LIST Z LEVAL FIHE EXTENSION
	MOVEI TT,0		;DATA MODE
	MOVSI TTT,'DSK'
	PUSHJ P,OUTSET
	POPJ P,
	PUSHJ P,FIHLST
	PUTHDR
	SETZM NWIRES
	SETZM TILCHS
	MOVEI TWLZMAR
	MOVEM T,MARGIN
	MOVEI T,[ASCIZ/	Wrap list -- PWR @]HA9@ZZ0AËYKX@b4eß4\\\\8\\]©<\\\\8\\\\9/SeÊ8\]ÑGV\\9K]ÏQP\\\9'SOÝXAÃ5J_:(-A(Y!	H')5A1u 4(&$baR4b4(Lj>Z!2nB=Re1²:j:thP&BVB)AeNB,4(lzR%!2n&i<M;KAc'OQi5Bz"l@<tDRj$	F/6]Dh(j&~jeebrreee&zeebrreebru}&*reh6F.=5brtL]f?¦ebru=vvD	fnU{PhPYu$T
BdDXD-Q!-K)Rdh4e Q!$dt
D4dqQ LlzhR¢K:=ÕEE=)kPhP
UD$
ez:,Q!l}hY¢K8%pHM~,M7"UTRL^f.bPT7-}RrreebrrjMrbreebrreee>O,Ubrt=VZeedf.l~FBreeeN}lblV*}QQ LlzhTjEI,HZ hP8U%ÔT
<APPM8ZETj	ItjAPPMIK"$iHpHK8iD:
Ir$t"dZhTbQ%TdZjsÐhU$	eºJy-5PUÔHZeƒ!d-9"dJtMEPPMJ)d*EIdk)hB¼jYDbz9t<D4t:=8tt Q!U:DTdZjh!d-$9:dJuLePPM
Z4DR
E}Zz#h+)D-5 L4ZH4BDIdJ	Hh!%,m	dBe)HU5Q M¤IxR$iHphP*%")D-5QPPLYzd,J
EE\89Rxw	FODRj$	F/6]Dh(n&~jeebrreee&zeebrreebru}&*reh6F.=5brtL]f?¦ebru=vvD	fnU{PhPYu4,T
BdDXD-Q!-K)Rdh4u Q!-K)Ru*YeH84}¬jD¬j4|tK|r$h!%D$d-j	`hPQ+$d-jSPM(YD,4	E¢AQ LlzhR¢K9u-$9
"%JKPhPYu4,T
BeZH4EQ!-9	"‚J
D}%1])e"IzDe4	trJKhP	uR
@hPG1MR	HU4,D
LjD}ZIt(Q+$d-j
sPM8ZETj	dDZ1PPL
*%RuHTt%1\<ZDrYd h!T}4T
BduYZLp4<-D	e,l(Z"|d
Lu4Sh!Etd
Bcˆ5\L2Zd,r	jTlZ$|2
	u˜Q!$dx,XiD8H8dM:DMSh!DeR
8Tl4HqK\i%"	2tzD
k!Q M¤IhR$iHpHK9HU4,D}$#z	xd2iz"ŠQ M%(8¢FKÜHZd,b%BLjhU"
8TuT	t2HZ5 h!DeR
8Tl4HqKÜHZd,bBdu"(T
k!Q M%)ib¢FK\ZhTrz$|$D4|$EPPL
*$*uJ%,tJ:BD:4|$ED$*B¼It[
B„dLr
*Tph!ERiD84t}HT4M*:B„d|2
*Tph+)D-5 LE*(R2J*Tte:E:H8t-"	yd*iyDd}yd:Z1PPL*YUbeD„z	 HK:TM"	btt	d-EAQ LlzhRHqPPLYzd*5H`hP
UD$
d%:J5%Q!\	b¼(Tdp4u
tMT	-WqPPL**5")HU5AQ M%)xR4HpHK8eJ	exd$D4<M(T}-D-£qQ LU*:BÔHZeQ!\	Bdh4u Q!-9	"‚J
U$DJ!PUÔHZe!5daKÜ8XUITj8Z-HT h!T}4TRd8Q!-9	"‚J	D„jAPPLYzd*UH`hP
UD$
e„H:u Q!-J:E\84MÒuJreebB{PhP8U%ÔT
D}Yj@hP
UD$
d$zyD,pQ!l}hY
GVh!5,E$zYe h!-$+Bd!PPM9y$:EbkˆQ!\Rx) h!%D0MZ9RJ=œv hP%Db[•QQ MZJ4L:D%’	E„jEhP:$d0Q+$d-jCPL
*$*uJ%,tJ:BD2Q LUYZ<*uETdZjh!}„$
`h!Q%d:	e#Ð8U%ÔT
D}Yj@hPYu5œ
BezLpQ!$$hT"e	jDbUhP*%"
	DqPPL
*%RUJu$)E*HQ!4-H9D"HUEKHK8D<-J4|K|jD-Q!4-H9D
HEDdx5hPhU$
Bd*J	trQ LE)I
E
BHh!d-$9"dEH$MEPPMJ)drEH4|KPPL**5"	H5sQ Lz4tyj0hP
UD$
ddx:u¸Q!U:Dd:	ch!Q%d:	cÐhU$
Bd"HI¢Q MZ9‚H!PPLhZDB%E"dJ	drH4<-D4}¬jD|2
	u	b$PPLhZDB
ED"d()"H4<-D$|%$M%1Q MZ9RID|	iPhP	uH hU	H5s7!$e(T,XiD8h*:DrGA-H+" "ðQ)d}Hbce
ZDMD%b
	MOVEI A,=12
	SUB A,TCOUNT
	PUTBYT "."
	SOJG A,.-1
	POPJ P,

PLCPPG:	MOVE A,PNTBL1(E)
	MOVE B,PNTBL2(E)
	PUSHJ P,PGPRTM		;PRINT WITH "-" FORMAT
	JRST PLCPN3
;SUBTTL RAYTHEON OUTPUT STUFF

SUBTTL	'RAY'		ROUTER RAYTHEON WIRE WRAP OUTPUT "TO-TO" FORMAT
RAYTT:	MOVE L,DEFLST
	PUSHJ P,LSTGET		;NOW ASK FOR PARTICULAR CARD!
	POPJ P,
	FETCH(T,W,WIRES)
	JUMPE T,[OUTSTR[ASCIZ/No wires!
/]
		POPJ P,]
	MOVSI T,'WTT'		;RAYTHEON WIRE WRAP EXTENSION
	MOVEI TT,0		;DATA MODE
	MOVSI TTT,'DSK'
	PUSHJ P,OUTSET
	POPJ P,
	SETZM NRUNS
	SETZM NWIRES
	SETZM TINCHS
	SETZM MARGIN		;NO MARGIN
	SETZM LINCNT
	MOVE T,[PGRAYY,,PGRAYN]	;ROUTE AND PRINT POWER AND GROUND
	PUSHJ P,PGSPEC
	SETZM PGBIT		;PRINT SIGNAL NAMES WHERE POSSIBLE
	FETCH(H,W,WIRES)	
RAYP0:	FETCH(T,H,WBIT)
	TRNE T,NAM2ND!WNULL!WSINGL!SNC!SPWR!SGND
	JRST RAYP1
	FETCH(G,H,WPIN)
	PUSHJ P,PGRAYY		;ROUTE AND PRINT NORMAL RUN
RAYP1:	FETCH(H,H,ALPH)
	JUMPN H,RAYP0
	RELEAS LST,		;THAT'S ALL FOLKS!
	MOVE T,[OUTCHR TTT]
	MOVEM T,PUTCHR
	PUSHJ P,PTOTS		;PRINT TOTALS ON TTY
	POPJ P,

;RAYTHEON NORMAL ROUTER SETUP

PGRAYY:	MOVEI T,RAYPW
	MOVEM T,WINDSP
	MOVEI T,RAYRNR		;PRINTS RUN NOT ROUTED MESSGE ON TTY
	MOVEM T,LOSDSP
	JRST ROUWIR

;RAYTHEON ROUTER WITH NO RUN ATTACHED TO POWER OR GROUND

PGRAYN:	MOVEI T,RAYPW
	MOVEI TT,RAYRNR
	JRST ROQPGZ
;SUBTTL RAYTHEON OUTPUT STUFF

SUBTTL	'RAY'		ROUTER RAYTHEON WIRE WRAP OUTPUT "FROM-TM" FORMAT
RAYP:	MOVE @Y'P!U'A@Y')(m.A'A=$A!I)+1$A%B(!!(A X()Q(Y\Y/%&R%+!A(Y7=+)'	I7'%4_ÞoSeËLB_tA!A@Y:%-$A(XOI2N$pJM"">rV&J*^JbR,rN&>ph(&6}2%%!1@$KZR
6>(h(&6}2N%‚%"Q1%-4PJBVNDQA2}*RN h(&B})A`h(&N-"j5uV:LhP&N%R5:y-1Q MXK$jIdE1Q MXK$jX$<La\tt	Ty`hP8U%ÔT	DL@PsUQ@33jhP"h#kc,V(kc*'DYa'Uj"P S"()e*(ibi g"#Ô'jg"E 	PUSHB P,PGSPEC
	SETZM PGBIT		;PRINT SIGNAL NAMES WHERE POSSIBLE
	FETCH(H$W,T%LR 4Uf PLhZDB
ADBex)"HQ!%”hT"dhStDtu¬ID=œhtb9h2
z"yh@hP2TJ:P+˜U#!!1Q59
k	…t)E!"B*
4rD
jxU"!tSu*H(3HDR)ÊSj)03
*3C"J(61U@c"U!d$$ f$FEe*fh$)lc"E i"S `iP)jB]j$ UiP S&#'S%iPFBfgkP*-ÓhTCHR TTT]
	MOVEM T,PUTCHR
	PUSHJ P,PTOTS		;PBINT TOTALS OJ DTY
	POPB P,

;RAYTHEON NORMAL ROUTER SETU@

PGWFTY:	MOVEI T,RAYFG
	MOVEM T,WINDSP	MOVEI T,RAYRNR
	MOVEM T,LOSDSP
	JRST ROUWIR

;RAYTHEON ROUTER WITH NO RUN ATTACHED TO POWER OR GROUND

PGWFTN:	MOVEI T,RAYFW
	MOVEI TT,RAYRNR
	JRST ROUPGZ

;HERE TO PRINT ERROR MESSAGE ON TTY IF RUN NOT ROUTED FOR SOME REASON

RAYRNR:	SKIPN PGBIT		;POWER OR GROUND?
	JRST [	OUTSTR ADDR(H,SPNT)
		JRST RAYRN1]
	OUTCHR GENCHR		;POWER GROUND SIGNAL NAME
	MOVE A,PNTBL1
	PUSH P,PUTCHR
	MOVE TTT,[OUTCHR TTT]
	MOVEM TTT,PUTCHR
	PUSHJ P,PGPRNT
	POP P,PUTCHR
RAYRN1:	OUTSTR [ASCIZ / Run not routed!
/]
	POPJ P,
;PRINT RUN IN RAYTHEON "FROM-TO" FORMAT

LVLCOL__=68	;THE COLUMN USED TO INDICATE LEVEL OF WRAP
RAYMAX__=17	;LONGEST WIRE RAYTHEON MACHINE CAN WRAP IS 24" (CITY BLOCK DISTANCE)
		;16.97=24*(SQRT(2)/2)

RAYFW:	SETZM TCOUNT
	SETZM INCHES
	SETZM RAYLVL		;KEEP TRACK OF LEVEL OF WIRE
	AOS RAYLVL		;    AND START WIRING ON LEVEL 1
	HRRZ G,ENDS		;THE BEGINING OF THE RUN
	MOVE T,NUMPIN		;GET NUMBER OF PINS -1
	TRNE T,1		;IS NUMBER OF PINS EVEN OR ODD (ODD IS 0)
	JRST RAYPA		;EVEN
	HRRE G,RUNLST(G)	;ODD, START WITH NEXT PIN IN RUN
	PUSH P,[RAYODD]		;ROUTINE TO DO LAST ODD WIRE
RAYPA:	HRRE F,RUNLST(G)	;GET ONE FOLLOWING US
	JUMPL F,CPOPJ		;QUIT IF NO NEXT
	PUSHJ P,RAYFRM		;PRINT LINE FOR THIS WIRE
RAYPB:	HRRE G,RUNLST(F)	;FIRST PIN OF NEXT LEVEL 1 WIRE
	JUMPL G,CPOPJ		;JUMP IF NONE THERE
	HRRE F,RUNLST(G)	;OTHER END OF NEXT LEVEL 1 WIRE
	JUMPL F,[JRST 4,.]	;ERROR, LAST WIRE ON RUN SHOULD ALWAYS BE LEVEL 1
	PUSHJ P,RAYFRM
	HLRE F,RUNLST(G)	;THE LEVEL TWO WIRE
	AOS RAYLVL
	PUSHJ P,RAYFRM
	SOS RAYLVL		;THE NEXT WIRE IS PROBABLY LEVEL 1
	HRRE F,RUNLST(G)	;GET F BACK
	JRST RAYPB

;TABS TO CARD COLUMN

DEFINE RAYTAB (COLUM)
<	MOVEI A,COLUM-1
	CAMG A,TCOUNT
	JRST .+3
	PUTBYT " "
	JRST .-3
>

;HERE TO DO CROSS LEVEL WIRE IF NUMBER PINS ON RUN IS ODD

RAYODD:	HRRE G,ENDS		;END OF WIRE
	HRRE F,RUNLST(G)	;OTHER END OF WIRE
	MOVEI B,2		;THIS WIRE IS ON LEVEL 2
	MOVEM B,RAYLVL
RAYFRM:	PUSHJ P,RAYDST		;KEEP TRACK OF RUN LENGTHS
	RAYTAB (=15)
	MOVE E,G		;ONE END OF THE WIRE
	PUSHJ P,RAYPNT
	MOVE E,F		;THE OTHER END OF THE WIRE
	PUSHJ P,RAYPNT		;PRINT PIN SPECIFICATION
	PUSHJ P,RAYSIG		;PRINT SIGNAL NAME AND RETURN
	RAYTAB (LVLCOL)		;PRINT LEVEL OF WIRE
	MOVE T,RAYLVL
	PUSHJ P,DECOUT
	JRST RAYSEQ		;PRINT CARD SEQUENCE # AND RETURN
;		RAYTHEON WIRE WRAP TO-TO FORMAT PRINTER

RAYPW:	SETZM INCHES
	SETZM TCOUNT		;YOU CAN'T BE TOO CAREFUL
	HRRZ G,ENDS		;GET AN END
RAYPT1:	RAYTAB (=15)
	MOVE E,G
	PUSHJ P,RAYPNT		;PRINT THIS PIN
	PUSHJ P,RAYSIG		;@RINT THE SIGNAL NAME
	PUSHJ P,RAYSEQ		;PRINT THE CARD SEQUENCE #
	HRRE F,RUNLST(G)
	JUMPL F,CPOPJ		;END OF RUN
	PUSHJ P,RAYDST		;LOG THIS WIRE AND TOTAL UP WIRE LENGTH
	MOVE G,F		;ADVANCE TO NEXT PIN
	JRST RAYPT1		;GET NEXT PIN ON RUN
	
RAYDST:	MOVE B,G		;COMPUTE LENGTH OF WIRE
	MOVE C,F
	PUSHJ P,DSTSTR
	MOVE T,WIRELN
	IDIV T,FRACTN
	SKIPE T			;ANY WIRE HERE?
	CAILE T,RAYMAX		;INSURE THAT UIRE DOES NOT EXCEED MAXIMUM LENGTH
	CAIA
	POPJ P,
	OQTSTR [ASCIZ /Line #/]
	PUSH P,T
	PUSH P,PUTCHR
	MOVE T,[OUTCHR TTT]
	MOVEM T,PUTCHR
	MOVE T,LINCNT
	SUBI T,1
	PUSHJ P,DECOUT
	POP P,PUTCHR
	POP P,T
	OUTCHR [40]	;THROW IN A SPACE
	OUTSTR ADDR(H,SPNT)	;PRINT SIGNAL NAME
	SKIPN T
	OUTSTR [ASCIZ / Wire in error
/]
	SKIPE T
	OUDSTR [ASCIZ / Point to point distance exceeds 17"
/]
	POPJ P,

RAYSIG:	RAYTAB (=31)
	SKIPE PGBIT
	JRST RAYFR1			;S@ECIAL HACK FOR POWER AND GROUND
	MOVEI A,=43			;DON'T PRINT PAST THIS CKLUMN (12 CHARACTERS)
	MOVEI TTT,ADDR(H,SPNT)		;PRINT THIS SIGNAL NAME
	HRLI TTT,440700			;MAKE IT A BYTE POINTER
RAYS1:	ILDB TT,TTT
	JUMPE TT,RAYFR2			;JUMP IF END MF STRING
	CAMGE A,TCOUNT			;MAKE SURE SIGNAL NAME AS NOT TOK LONC
	JRST Y	OUTSTR ADDR(H,SPNT)
		OQTSTR [ASCIZ / Longer than 12 characterp_t)%'(AI3$I:A+)3P@Q)($I'(A%3&b(%e$bt%!+)e(A9$$w%)Š!/HA%UA'=+%
4Y
AYA)˜Dw€$BBLp4(&*N"	2B:P$KZBJ&u!B&p:6(h*JL2IIhM.&BrV&J,b8$%]:&JJ9>I|hP&BV%RI\
N&R=)RQ)_O'rKK6t4
RAYSEQ:	RAYTAB (=72)		;PRINT THE SEQUENCE # OF THE CARD
ITS,<	PUTSTR [ASCIZ /MIT/]	>
CMU,<	PUTSTR [ASCIZ /CMU/]	>
	MOVEI A,5
	MOVEM A,NDIG
	MOVE T,LINCNT
	PUSHJ P,NDECOUT
	CRLF
	SETZM TCOUNT		;COUNT CHARACTERS ON LINE
	POPJ P,

RAYPNT:	MOVSI T,RPGPIN		;BLACK MAGIC
	TDNE T,PNTBL(E)
	JRST [	MOVE A,PNTBL1(E)
		MOVE B,PNTBL2(E)
		JRST RAYGEN]	;ZLEVEL USES MINUS FORMAT BUT . . .
	HRRZ E,PNTBL(E)
	FETCH(D,E,PBDY)		;D GETS BODY POINTER
	FETCH(A,D,BLOC)
	FETCH(T,E,PINN)
	HRLI A,(T)
	FETCH(T,D,BBIT)
	TRNN T,CBODY		;CONNECTOR PIN?
	JRST RAYPN1		;NO
	AOS NCONS		;COUNT CONNECTOR PINS ON RUN
	JRST RAYCON		;PRINT

RAYPN1:	FETCH(T,D,DIPT)
	FETCH(B,T,DPNN)		;GET COUNT OF PINS IN DIP
	FETCH(T,D,BBIT)		;GET BODY BITS
	JRST RAYDIP
>;ROUTE
  